<!DOCTYPE html<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transmission</title>
    <link rel="stylesheet" href="style2.css">
</head>
<body>

<div class="container">
    <header>
        <h1>Alright</h1>
        <div class="status-badge">‚óè Server Online</div>
    </header>

    <div class="drop-zone" id="drop-zone">
        <div class="drop-zone__content">
            <span class="drop-zone__icon">‚ú¶</span>
            <span class="drop-zone__text">Drop images or <strong>browse</strong></span>
        </div>

        <div class="drop-zone__previews" id="preview-container"></div>

        <input type="file" id="file-input" accept="image/*" multiple hidden>
    </div>

    <div class="input-wrapper">
        <div class="label-row">
            <label for="server-msg">Transmission</label>
            <span class="char-count">Encrypted</span>
        </div>

        <textarea id="server-msg" placeholder="Write your message..."></textarea>

        <button class="submit-btn" id="submit-btn">
            <span>Push to Server</span>
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
            </svg>
        </button>
    </div>
</div>

<script>
const dropZone = document.getElementById("drop-zone");
const fileInput = document.getElementById("file-input");
const previewContainer = document.getElementById("preview-container");
const submitBtn = document.getElementById("submit-btn");
const messageInput = document.getElementById("server-msg");

let files = [];

// Open file picker
dropZone.addEventListener("click", () => fileInput.click());

// File input
fileInput.addEventListener("change", () => {
    addFiles(fileInput.files);
});

// Drag & drop
dropZone.addEventListener("dragover", e => {
    e.preventDefault();
    dropZone.classList.add("active");
});

dropZone.addEventListener("dragleave", () => {
    dropZone.classList.remove("active");
});

dropZone.addEventListener("drop", e => {
    e.preventDefault();
    dropZone.classList.remove("active");
    addFiles(e.dataTransfer.files);
});

// Add files & preview
function addFiles(fileList) {
    [...fileList].forEach(file => {
        if (!file.type.startsWith("image/")) return;
        files.push(file);
        previewImage(file);
    });

    if (files.length) {
        dropZone.classList.add("has-files");
    }
}

// Create preview
function previewImage(file) {
    const reader = new FileReader();
    reader.onload = () => {
        const div = document.createElement("div");
        div.className = "preview";

        const img = document.createElement("img");
        img.src = reader.result;

        div.appendChild(img);
        previewContainer.appendChild(div);
    };
    reader.readAsDataURL(file);
}

// Upload
submitBtn.addEventListener("click", async () => {
    if (!files.length && !messageInput.value.trim()) {
        alert("Nothing to send.");
        return;
    }

    const formData = new FormData();
    files.forEach(file => formData.append("images[]", file));
    formData.append("message", messageInput.value);

    try {
        const res = await fetch("/upload", {
            method: "POST",
            body: formData
        });

        if (!res.ok) throw new Error();

        alert("Transmission successful üöÄ");

        files = [];
        previewContainer.innerHTML = "";
        messageInput.value = "";
        fileInput.value = "";
        dropZone.classList.remove("has-files");

    } catch {
        alert("Server error.");
    }
});
</script>

</body>
</html>

